# ============================================================
# SafeAR Ver 18.0 - Hyper Sense (High-Res & Color Coded)
# ÁîüÊàêÁâ©: SafeAR_Hyper_V18.zip
# ============================================================

import os, zipfile

# Ë®≠ÂÆö
PROJECT_NAME = "SafeAR-Hyper-V18"
PACKAGE_DIR = "app/src/main/java/jp/kamijima/safear/v18"
RES_DIR = "app/src/main/res"

def write_file(zipf, path, content):
    zipf.writestr(path, content.strip() + "\n")

print(f"üì¶ Generating High-Performance Repository: {PROJECT_NAME}...")

with zipfile.ZipFile("SafeAR_Hyper_V18.zip", "w") as z:

    # 1. GitHub Actions (YAML)
    workflow_content = """name: Android CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: gradle

      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      - name: Build with Gradle
        run: ./gradlew assembleDebug

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: SafeAR-V18-Hyper
          path: app/build/outputs/apk/debug/app-debug.apk
"""
    write_file(z, ".github/workflows/android.yml", workflow_content)

    # 2. README
    write_file(z, "README.md", """
# üõ°Ô∏è SafeAR: Hyper Sense Edition (Ver 18.0)

![Android](https://img.shields.io/badge/Android-16%20Ready-3DDC84?style=for-the-badge&logo=android&logoColor=white)
![Build Status](https://img.shields.io/badge/build-passing-brightgreen?style=for-the-badge)

**SafeAR V18** pushes the limits of on-device AI detection.

## üöÄ New Features in V18
* **High-Res Analysis:** Upgraded AI input to HD (1280x720) for sharper detection.
* **Hyper Tracking:** Inertial prediction keeps tracking even when the camera moves fast.
* **Color Coded HUD:** * üü¶ **Human** (Cyan)
    * üü• **Vehicle** (Red)
    * üü© **Bike** (Green)
* **Translucent UI:** Semi-transparent fill for better visibility.

## üõ†Ô∏è How to Build
1. Upload to GitHub.
2. Check Actions tab.
3. Download APK.
""")

    # 3. .gitignore
    write_file(z, ".gitignore", """
*.iml
.gradle
/local.properties
/.idea
.DS_Store
/build
/captures
.externalNativeBuild
.cxx
""")

    # 4. Gradle Settings
    write_file(z, "settings.gradle", f"""
pluginManagement {{ repositories {{ google(); mavenCentral(); gradlePluginPortal() }} }}
dependencyResolutionManagement {{ repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS); repositories {{ google(); mavenCentral() }} }}
rootProject.name = "{PROJECT_NAME}"
include ':app'
""")

    # 5. Build Files
    write_file(z, "build.gradle", "plugins { id 'com.android.application' version '8.3.2' apply false }")
    write_file(z, "gradle.properties", "org.gradle.jvmargs=-Xmx3g\nandroid.useAndroidX=true\nandroid.enableJetifier=true")

    # 6. App Module
    write_file(z, "app/build.gradle", """
plugins { id 'com.android.application' }

android {
    namespace 'jp.kamijima.safear.v18'
    compileSdk 35
    defaultConfig {
        applicationId "jp.kamijima.safear.v18"
        minSdk 26
        targetSdk 35
        versionCode 18
        versionName "18.0"
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }
    buildFeatures { viewBinding true }
}

dependencies {
    implementation 'androidx.appcompat:appcompat:1.6.1'
    implementation 'com.google.android.material:material:1.11.0'
    def cx = "1.3.4"
    implementation "androidx.camera:camera-core:${cx}"
    implementation "androidx.camera:camera-camera2:${cx}"
    implementation "androidx.camera:camera-lifecycle:${cx}"
    implementation "androidx.camera:camera-view:${cx}"
    implementation 'com.google.mlkit:object-detection:17.0.2'
}
""")

    # 7. Manifest
    write_file(z, "app/src/main/AndroidManifest.xml", """<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.INTERNET" />
    <application
        android:allowBackup="true"
        android:label="SafeAR Hyper"
        android:theme="@style/Theme.AppCompat.NoActionBar">
        <activity android:name=".MainActivity" android:exported="true" android:screenOrientation="portrait">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>
</manifest>
""")

    # 8. Layout
    write_file(z, f"{RES_DIR}/layout/activity_main.xml", """<?xml version="1.0" encoding="utf-8"?>
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="#000000"
    android:fitsSystemWindows="true">
    
    <androidx.camera.view.PreviewView android:id="@+id/previewView" android:layout_width="match_parent" android:layout_height="match_parent"/>
    <jp.kamijima.safear.v18.OverlayView android:id="@+id/overlay" android:layout_width="match_parent" android:layout_height="match_parent"/>

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="60dp"
        android:background="#44000000"
        android:orientation="horizontal"
        android:gravity="center_vertical"
        android:paddingHorizontal="20dp">
        <ImageButton android:id="@+id/btnSwitchCam" android:layout_width="40dp" android:layout_height="40dp" android:background="@android:drawable/ic_menu_camera" android:backgroundTint="#00FFCC" android:alpha="0.9"/>
        <View android:layout_width="0dp" android:layout_height="1dp" android:layout_weight="1"/>
        <TextView android:text="SYSTEM: HYPER SENSE" android:textColor="#00FFCC" android:typeface="monospace" android:textSize="12sp" android:textStyle="bold" android:layout_width="wrap_content" android:layout_height="wrap_content"/>
        <View android:layout_width="0dp" android:layout_height="1dp" android:layout_weight="1"/>
        <ImageButton android:id="@+id/btnSettings" android:layout_width="40dp" android:layout_height="40dp" android:background="@android:drawable/ic_menu_preferences" android:backgroundTint="#00FFCC" android:alpha="0.9"/>
    </LinearLayout>

    <LinearLayout
        android:id="@+id/panelSettings"
        android:layout_width="320dp"
        android:layout_height="wrap_content"
        android:layout_gravity="center"
        android:orientation="vertical"
        android:background="#EE111111"
        android:padding="24dp"
        android:visibility="gone"
        android:elevation="20dp">
        <TextView android:text="HYPER SETTINGS" android:textColor="#00FFCC" android:textSize="18sp" android:textStyle="bold" android:typeface="monospace" android:layout_marginBottom="20dp"/>
        <Switch android:id="@+id/swTorch" android:text="TORCH LIGHT" android:textColor="#FFFFFF" android:typeface="monospace" android:layout_width="match_parent" android:layout_height="wrap_content" android:padding="10dp" android:thumbTint="#00FFCC" android:trackTint="#5500FFCC"/>
        <View android:layout_width="match_parent" android:layout_height="1dp" android:background="#333333" android:layout_marginVertical="10dp"/>
        <Switch android:id="@+id/swVoice" android:text="VOICE ALERT" android:textColor="#FFFFFF" android:typeface="monospace" android:checked="true" android:layout_width="match_parent" android:layout_height="wrap_content" android:padding="10dp" android:thumbTint="#00FFCC" android:trackTint="#5500FFCC"/>
        <Switch android:id="@+id/swFocus" android:text="HYPER TRACKING" android:textColor="#FFFFFF" android:typeface="monospace" android:checked="true" android:layout_width="match_parent" android:layout_height="wrap_content" android:padding="10dp" android:thumbTint="#00FFCC" android:trackTint="#5500FFCC"/>
        <Button android:id="@+id/btnClose" android:text="CLOSE" android:typeface="monospace" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginTop="20dp" android:backgroundTint="#333333" android:textColor="#00FFCC"/>
    </LinearLayout>
</FrameLayout>
""")

    # 9. OverlayView (ÂçäÈÄèÊòé„ÉªËâ≤ÂàÜ„ÅëÂº∑Âåñ)
    write_file(z, f"{PACKAGE_DIR}/OverlayView.java", """
package jp.kamijima.safear.v18;

import android.content.Context;
import android.graphics.*;
import android.util.AttributeSet;
import android.view.View;
import java.util.*;

public class OverlayView extends View {
    public static class Tracked {
        public RectF box;
        public String label; 
        public boolean isApproaching;
        public int baseColor; // „Éô„Éº„ÇπËâ≤
    }
    
    private final Paint pStroke = new Paint();
    private final Paint pFill = new Paint();
    private final Paint pText = new Paint();
    private final Paint pWarnText = new Paint();
    private final Path trianglePath = new Path();

    private List<Tracked> items = new ArrayList<>();
    
    public OverlayView(Context c, AttributeSet a) {
        super(c, a);
        
        pStroke.setStyle(Paint.Style.STROKE);
        pStroke.setStrokeWidth(6f);
        pStroke.setStrokeCap(Paint.Cap.ROUND);
        pStroke.setAntiAlias(true);
        
        pFill.setStyle(Paint.Style.FILL);
        pFill.setAntiAlias(true);
        
        pText.setColor(Color.WHITE);
        pText.setTypeface(Typeface.create(Typeface.MONOSPACE, Typeface.BOLD));
        pText.setTextSize(36f);
        pText.setShadowLayer(4f, 0f, 0f, Color.BLACK);
        
        pWarnText.setColor(Color.YELLOW);
        pWarnText.setTypeface(Typeface.DEFAULT_BOLD);
        pWarnText.setTextSize(60f);
        pWarnText.setTextAlign(Paint.Align.CENTER);
        pWarnText.setShadowLayer(5f, 0f, 0f, Color.BLACK);
    }
    
    public void setItems(List<Tracked> list) {
        this.items = list;
        postInvalidate();
    }
    
    @Override protected void onDraw(Canvas c) {
        super.onDraw(c);
        int w = getWidth(); int h = getHeight();
        if (w == 0 || h == 0 || items == null) return;

        for (Tracked t : items) {
            if (t.box == null) continue;

            // 1. Ëâ≤„ÅÆË®≠ÂÆö
            int color = t.baseColor;
            if (t.isApproaching) color = Color.RED; // Êé•ËøëÊôÇ„ÅØÂº∑Âà∂Ëµ§

            // 2. ÂçäÈÄèÊòé„ÅÆÂ°ó„Çä„Å§„Å∂„Åó (Alpha 40/255)
            pFill.setColor(color);
            pFill.setAlpha(40); 
            c.drawRect(t.box, pFill);

            // 3. Êû†Á∑ö
            pStroke.setColor(color);
            pStroke.setShadowLayer(10f, 0f, 0f, color);
            c.drawRect(t.box, pStroke);

            // 4. Ë≠¶ÂëäË°®Á§∫
            if (t.isApproaching) {
                drawWarningSign(c, t.box.centerX(), t.box.top - 50);
            }

            // 5. „É©„Éô„É´
            String info = t.label;
            float txtW = pText.measureText(info);
            float labelX = t.box.left;
            float labelY = t.box.top - 10;
            if (labelY < 50) labelY = t.box.bottom + 40;

            pFill.setAlpha(200); // „É©„Éô„É´ËÉåÊôØ„ÅØÊøÉ„Åè
            c.drawRect(labelX - 5, labelY - 35, labelX + txtW + 10, labelY + 10, pFill);
            c.drawText(info, labelX, labelY, pText);
        }
    }

    private void drawWarningSign(Canvas c, float cx, float cy) {
        float size = 80f; float half = size / 2f;
        trianglePath.reset();
        trianglePath.moveTo(cx, cy - half);
        trianglePath.lineTo(cx + half, cy + half);
        trianglePath.lineTo(cx - half, cy + half);
        trianglePath.close();
        
        pFill.setColor(Color.YELLOW);
        pFill.setAlpha(255);
        c.drawPath(trianglePath, pFill);
        
        pStroke.setColor(Color.BLACK);
        pStroke.setStrokeWidth(4f);
        c.drawPath(trianglePath, pStroke);
        
        pText.setColor(Color.BLACK);
        pText.setTextSize(60f);
        float tw = pText.measureText("!");
        c.drawText("!", cx - tw/2, cy + half - 10, pText);
        
        // Restore text color
        pText.setColor(Color.WHITE); 
    }
}
""")

    # 10. MainActivity (È´òÁ≤æÂ∫¶Ë™çË≠ò„É≠„Ç∏„ÉÉ„ÇØ)
    write_file(z, f"{PACKAGE_DIR}/MainActivity.java", """
package jp.kamijima.safear.v18;

import android.Manifest;
import android.content.pm.PackageManager;
import android.graphics.*;
import android.os.*;
import android.speech.tts.TextToSpeech;
import android.util.Log;
import android.util.Size; // For resolution
import android.view.View;
import android.widget.*;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.camera.core.*;
import androidx.camera.lifecycle.ProcessCameraProvider;
import androidx.camera.view.PreviewView;
import androidx.core.app.ActivityCompat;
import androidx.core.content.ContextCompat;
import com.google.common.util.concurrent.ListenableFuture;
import com.google.mlkit.vision.common.InputImage;
import com.google.mlkit.vision.objects.*;
import com.google.mlkit.vision.objects.defaults.ObjectDetectorOptions;
import java.util.*;
import java.util.concurrent.*;

public class MainActivity extends AppCompatActivity implements TextToSpeech.OnInitListener {
    private static final String TAG = "SafeAR";
    private PreviewView previewView;
    private OverlayView overlay;
    private ExecutorService cameraExecutor;
    private TextToSpeech tts;
    
    private ImageButton btnSettings, btnSwitchCam;
    private View panelSettings;
    private Button btnClose;
    private Switch swVoice, swFocus, swTorch;

    private boolean isVoiceOn = true;
    private boolean isTrackingOn = true;
    private long lastSpeakTime = 0;
    
    // Tracking Memory
    private Map<Integer, Long> lastTimeMap = new ConcurrentHashMap<>();
    private Map<Integer, Float> lastWidthMap = new ConcurrentHashMap<>();
    private Map<Integer, RectF> smoothedBoxes = new ConcurrentHashMap<>();
    
    private ProcessCameraProvider cameraProvider;
    private CameraSelector currentCameraSelector = CameraSelector.DEFAULT_BACK_CAMERA;
    private Camera camera;
    
    @Override protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        initUI();
        cameraExecutor = Executors.newSingleThreadExecutor();
        tts = new TextToSpeech(this, this);
        if (ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) {
            startCamera();
        } else {
            ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.CAMERA}, 10);
        }
    }

    private void initUI() {
        previewView = findViewById(R.id.previewView);
        overlay = findViewById(R.id.overlay);
        btnSettings = findViewById(R.id.btnSettings);
        btnSwitchCam = findViewById(R.id.btnSwitchCam);
        panelSettings = findViewById(R.id.panelSettings);
        btnClose = findViewById(R.id.btnClose);
        swVoice = findViewById(R.id.swVoice);
        swFocus = findViewById(R.id.swFocus);
        swTorch = findViewById(R.id.swTorch);

        btnSettings.setOnClickListener(v -> panelSettings.setVisibility(View.VISIBLE));
        btnClose.setOnClickListener(v -> panelSettings.setVisibility(View.GONE));
        btnSwitchCam.setOnClickListener(v -> switchCamera());

        swVoice.setOnCheckedChangeListener((v,c) -> isVoiceOn = c);
        swFocus.setOnCheckedChangeListener((v,c) -> isTrackingOn = c);
        
        swTorch.setOnCheckedChangeListener((v, isChecked) -> {
            if (camera != null && camera.getCameraInfo().hasFlashUnit()) {
                camera.getCameraControl().enableTorch(isChecked);
            } else { v.setChecked(false); }
        });
    }

    private void switchCamera() {
        if (cameraProvider == null) return;
        try {
            if (currentCameraSelector == CameraSelector.DEFAULT_BACK_CAMERA) {
                if (cameraProvider.hasCamera(CameraSelector.DEFAULT_FRONT_CAMERA)) {
                    currentCameraSelector = CameraSelector.DEFAULT_FRONT_CAMERA;
                }
            } else {
                currentCameraSelector = CameraSelector.DEFAULT_BACK_CAMERA;
            }
            swTorch.setChecked(false);
            bindCameraUseCases();
        } catch(Exception e) { Log.e(TAG, "Switch failed", e); }
    }
    
    @Override public void onInit(int status) {
        if (status == TextToSpeech.SUCCESS) tts.setLanguage(Locale.JAPAN);
    }
    
    private void speak(String text) {
        if(isVoiceOn && (System.currentTimeMillis() - lastSpeakTime > 3000)) {
            tts.speak(text, TextToSpeech.QUEUE_FLUSH, null, "ID");
            lastSpeakTime = System.currentTimeMillis();
        }
    }

    @Override public void onRequestPermissionsResult(int rc, String[] perms, int[] res) {
        super.onRequestPermissionsResult(rc, perms, res);
        if (res.length > 0 && res[0] == PackageManager.PERMISSION_GRANTED) startCamera();
    }

    private void startCamera() {
        ListenableFuture<ProcessCameraProvider> future = ProcessCameraProvider.getInstance(this);
        future.addListener(() -> {
            try {
                cameraProvider = future.get();
                bindCameraUseCases();
            } catch (Exception e) { Log.e(TAG, "Init Error", e); }
        }, ContextCompat.getMainExecutor(this));
    }
    
    private void bindCameraUseCases() {
        if (cameraProvider == null) return;
        try {
            cameraProvider.unbindAll();
            
            Preview preview = new Preview.Builder().build();
            preview.setSurfaceProvider(previewView.getSurfaceProvider());
            
            // Hyper Sense: High Resolution Analysis
            ImageAnalysis analysis = new ImageAnalysis.Builder()
                .setTargetResolution(new Size(1280, 720)) // HDËß£Êûê„ÅßÁ≤æÂ∫¶„Ç¢„ÉÉ„Éó
                .setBackpressureStrategy(ImageAnalysis.STRATEGY_KEEP_ONLY_LATEST)
                .build();
            
            ObjectDetector detector = ObjectDetection.getClient(
                new ObjectDetectorOptions.Builder()
                    .setDetectorMode(ObjectDetectorOptions.STREAM_MODE)
                    .enableMultipleObjects()
                    .enableClassification() // ÂàÜÈ°ûÂøÖÈ†à
                    .build()
            );

            analysis.setAnalyzer(cameraExecutor, proxy -> {
                try {
                    InputImage img = InputImage.fromMediaImage(proxy.getImage(), proxy.getImageInfo().getRotationDegrees());
                    if (img != null) {
                        detector.process(img)
                            .addOnSuccessListener(objects -> drawObjects(objects, proxy))
                            .addOnFailureListener(e -> proxy.close());
                    } else proxy.close();
                } catch (Exception e) { proxy.close(); }
            });
            camera = cameraProvider.bindToLifecycle(this, currentCameraSelector, preview, analysis);
        } catch(Exception e) { Log.e(TAG, "Bind Error", e); }
    }

    private void drawObjects(List<DetectedObject> objects, ImageProxy proxy) {
        try {
            int vw = overlay.getWidth(); int vh = overlay.getHeight();
            if (vw == 0 || vh == 0) return;
            
            int rot = proxy.getImageInfo().getRotationDegrees();
            int iw = (rot == 90 || rot == 270) ? proxy.getHeight() : proxy.getWidth();
            int ih = (rot == 90 || rot == 270) ? proxy.getWidth() : proxy.getHeight();
            float sx = (float)vw / iw; float sy = (float)vh / ih;
            
            long now = System.currentTimeMillis();
            boolean alertNeeded = false;
            String alertWord = "";

            List<OverlayView.Tracked> list = new ArrayList<>();
            Set<Integer> currentIds = new HashSet<>();

            for(DetectedObject obj : objects) {
                Integer id = obj.getTrackingId();
                if (id == null) continue;
                currentIds.add(id);

                // Â∫ßÊ®ôÂ§âÊèõ„Å®„Çπ„É†„Éº„Ç∏„É≥„Ç∞
                Rect r = obj.getBoundingBox();
                RectF currentBox = new RectF(r.left*sx, r.top*sy, r.right*sx, r.bottom*sy);
                
                if (smoothedBoxes.containsKey(id)) {
                    RectF prev = smoothedBoxes.get(id);
                    // Ë£úÈñì„ÇíÂº∑„Åè„Åó„Å¶Êªë„Çâ„Åã„Å´ (0.3)
                    float alpha = 0.3f; 
                    currentBox.left = prev.left + alpha * (currentBox.left - prev.left);
                    currentBox.top = prev.top + alpha * (currentBox.top - prev.top);
                    currentBox.right = prev.right + alpha * (currentBox.right - prev.right);
                    currentBox.bottom = prev.bottom + alpha * (currentBox.bottom - prev.bottom);
                }
                smoothedBoxes.put(id, currentBox);

                // „Ç´„ÉÜ„Ç¥„É™Âà§ÂÆö„Å®Ëâ≤ÂàÜ„Åë
                String label = "Áâ©‰Ωì";
                int color = Color.WHITE; // Default
                
                for(DetectedObject.Label l : obj.getLabels()) {
                    String text = l.getText().toLowerCase();
                    if (text.contains("person") || text.contains("human")) {
                        label = "HUMAN"; color = Color.CYAN;
                    } else if (text.contains("car") || text.contains("vehicle") || text.contains("bus")) {
                        label = "CAR"; color = Color.RED;
                    } else if (text.contains("bike") || text.contains("bicycle")) {
                        label = "BIKE"; color = Color.GREEN;
                    }
                }
                // „Éá„Éï„Ç©„É´„Éà„ÅÆ„Åæ„Åæ„Å™„ÇâÁâ©‰Ωì
                if(label.equals("Áâ©‰Ωì")) {
                     label = "UNKNOWN"; color = Color.LTGRAY;
                }

                OverlayView.Tracked t = new OverlayView.Tracked();
                t.box = currentBox;
                t.label = label;
                t.baseColor = color;
                t.isApproaching = false;

                // Êé•ËøëÂà§ÂÆö (TTC)
                if (lastTimeMap.containsKey(id)) {
                    long prevTime = lastTimeMap.get(id);
                    float prevW = lastWidthMap.get(id);
                    long dt = now - prevTime;
                    if (dt > 0 && prevW > 0) {
                        float growth = t.box.width() / prevW;
                        // 1.02ÂÄç‰ª•‰∏ä„ÅÆÊÄ•Êã°Â§ß„ÅßÊé•Ëøë„Å®„Åø„Å™„Åô
                        if (growth > 1.02f) {
                            t.isApproaching = true;
                            alertNeeded = true;
                            alertWord = "Ê≥®ÊÑèÔºÅ" + label + "Êé•Ëøë";
                        }
                    }
                }
                lastTimeMap.put(id, now);
                lastWidthMap.put(id, t.box.width());

                // „ÄåÂ∏∏„Å´Ë™çË≠ò„Äç: „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åõ„ÅöÂÖ®„Å¶ËøΩÂä†
                list.add(t);
            }
            
            // „É≠„Çπ„Éà„Åó„ÅüID„ÅÆ„Ç¥„ÉüÊéÉÈô§
            smoothedBoxes.keySet().retainAll(currentIds);
            
            overlay.setItems(list);
            
            if (alertNeeded) speak(alertWord);
            
        } catch(Exception t) { Log.e(TAG, "Draw Error", t); } finally { proxy.close(); }
    }
    
    @Override protected void onDestroy() {
        if (tts != null) { tts.stop(); tts.shutdown(); }
        super.onDestroy();
        cameraExecutor.shutdown();
    }
}
""")

print("‚úÖ GitHub Repository Zip Created: SafeAR_Hyper_V18.zip")
